<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.library.bookwave.repository.interfaces.EbookRepository">

	<select
		id="readUserEbook"
		resultType="com.library.bookwave.repository.model.UserEbook">
		select * from user_ebook_tb where user_id = #{userId} and book_id = #{bookId}
	</select>
	
	<select
		id="findEbookPathByBookId"
		resultType="String">
		select ebook_path from book_tb where id = #{bookId}
	</select>
	
	<update id="updateUserEbookWithLastPoint">
		update user_ebook_tb set last_point = #{lastPoint}, last_read_date = now() where user_id = #{userId} and book_id = #{bookId}
	</update>
	
	<select
		id="findEbookListByUserId"
		resultType="com.library.bookwave.dto.EbookDTO">
		select b.id, b.title, b.cover, ue.last_read_date from book_tb b join user_ebook_tb ue on b.id = ue.book_id where ue.user_id = #{userId} and ue.status = 0 order by ue.last_read_date desc
	</select>
	
	<update id="updateUserEbookWithStatus">
		update user_ebook_tb set status = #{status} where user_id = #{userId} and book_id = #{bookId}
	</update>
	
</mapper>